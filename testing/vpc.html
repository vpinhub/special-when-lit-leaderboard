<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competition Scores</title>
    <link href="https://fonts.googleapis.com/css2?family=Encode+Sans&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Encode Sans', sans-serif; margin: 0; padding: 20px; }
        .leaderboard-item { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
        .avatar { border-radius: 50%; width: 50px; height: 50px; margin-right: 10px; }
        .score-details { flex: 1; text-align: left; }
        .score { font-weight: bold; font-size: 18px; }
    </style>
</head>
<body>
    <div id="score-list"></div>
    <div style="text-align: center; margin-top: 20px;">
        <a href="https://virtualpinballchat.com/" target="_blank" style="color: #f97316; font-weight: bold; text-decoration: none;">VIEW ALL SCORES</a>
    </div>
    <script>
        async function fetchAndDisplayScores() {
            const scoreList = document.getElementById("score-list");
            try {
                const response = await fetch('https://virtualpinballchat.com/vpc/api/v1/weeksByChannelName');
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const allChannelsData = await response.json();
                const compChannel = allChannelsData.find(channel => channel.channelName === "competition-corner");
                const currentWeek = compChannel.weeks.find(week => week.isArchived === false);
                updateScores(currentWeek);
            } catch (error) {
                scoreList.innerHTML = `<p style="text-align:center; color:red;">Failed to load scores.</p>`;
            }
        }

        function updateScores(weekData) {
            const sortedScores = weekData.scores.sort((a, b) => b.score - a.score);
            const scoreList = document.getElementById("score-list");
            scoreList.innerHTML = sortedScores.map(score => `
                <div class="leaderboard-item">
                    <img src="${score.userAvatarUrl}" alt="avatar" class="avatar">
                    <div class="score-details">
                        <div class="username">${score.username}</div>
                        <div class="score">${score.score.toLocaleString()}</div>
                    </div>
                </div>`).join('');
        }
        fetchAndDisplayScores();
    </script>
</body>
</html>
