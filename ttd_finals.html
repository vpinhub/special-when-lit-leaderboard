<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TTD Leaderboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Encode+Sans&family=MedievalSharp&display=swap" rel="stylesheet">
  <style>
      body {
          font-family: 'Encode Sans', sans-serif;
          margin: 0;
          padding: 20px;
          background: linear-gradient(to bottom, #6c7a89, #2c3e50);
          color: white;
          text-shadow: 1px 1px 4px black;
          text-align: center;
      }
      .header-image {
          display: block;
          margin: 0 auto;
          width: 75%;
          max-width: 300px;
      }
      .columns {
          display: flex;
          justify-content: center;
          gap: 20px;
          margin-top: 20px;
      }
      .column {
          flex: 1;
          max-width: 300px;
      }
      .leaderboard-item {
          display: flex;
          align-items: center;
          margin-bottom: 10px;
          background: rgba(255, 255, 255, 0.85);
          padding: 10px;
          border-radius: 8px;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
          color: #2c3e50;
      }
      .avatar {
          border-radius: 50%;
          width: 50px;
          height: 50px;
          margin-right: 10px;
          border: 2px solid #1f3a93;
      }
      .score-details {
          flex: 1;
          text-align: left;
      }
      .rank {
          font-weight: bold;
          margin-right: 10px;
          color: #1f3a93;
      }
      .score {
          font-weight: bold;
          font-size: 18px;
          color: black;
      }
      h1, h2 {
          color: #ddd;
          text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.5);
      }
      #date {
          font-family: 'MedievalSharp', cursive;
          font-size: 24px;
          color: #f1c40f;
          text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.7);
      }
  </style>
</head>
<body>
	<img src="https://iscored.info/images/games/game87385" alt="Charlie Brown logo" class="header-image">
  
  <div class="columns">
      <div class="column" id="column-1"></div>
      <div class="column" id="column-2"></div>
      <div class="column" id="column-3"></div>
  </div>

  <h1>A Charlie Brown Christmas (Original 2023)</h2>
  <h2 id="date"></h2>

  <script>
    document.getElementById('date').textContent = new Date().toLocaleDateString();

    function formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    function fetchLeaderboard(url, containerIds) {
        fetch(url)
          .then(response => response.json())
          .then(jsonData => {
              const playerScores = {};
              jsonData.forEach(player => {
                  const score = parseInt(player.score, 10);
                  if (!playerScores[player.name] || score > playerScores[player.name].score) {
                      playerScores[player.name] = { name: player.name, score };
                  }
              });

              const sortedPlayers = Object.values(playerScores).sort((a, b) => b.score - a.score);

              const playersPerColumn = Math.ceil(sortedPlayers.length / containerIds.length);
              containerIds.forEach((id, colIndex) => {
                  const column = document.getElementById(id);
                  const columnPlayers = sortedPlayers.slice(colIndex * playersPerColumn, (colIndex + 1) * playersPerColumn);

                  columnPlayers.forEach((player, index) => {
                      const item = document.createElement('div');
                      item.classList.add('leaderboard-item');

                      const avatarPath = `img/${player.name.replace(/\s+/g, '_')}.gif`;
                      const avatar = `<img src="${avatarPath}" alt="${player.name}" class="avatar" onerror="this.style.display='none'">`;

                      item.innerHTML = `
                        <div class="rank">${colIndex * playersPerColumn + index + 1}.</div>
                        ${avatar}
                        <div class="score-details">
                          <div class="username">${player.name}</div>
                          <div class="score">${formatNumber(player.score)}</div>
                        </div>
                      `;
                      column.appendChild(item);
                  });
              });
          })
          .catch(error => console.error('Error fetching leaderboard data:', error));
    }

    fetchLeaderboard('https://comp.pinballwizards.us/ttd/scores.json', ['column-1', 'column-2', 'column-3']);
  </script>
</body>
</html>
